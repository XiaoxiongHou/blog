# 经典案例

## DNS产品加载欧拉升级补丁失败

任务背景：第三方

【升级失败 - 存储bypass场景的/rootbak/var/log目录不可用】

现象：升级任务界面日志显示升级失败

原因：第三方将var/log目录改为了软链接，chroot /rootbak目录后，软链接失效，导致了部分rpm包安装失败。

解决：手动修改FS发布的tar包psp_rpm_patch.sh脚本，在chroot前删除软链接并创建空目录，以完成rpm安装。最终方案需要让三方修改软链接以适配欧拉通用升级机制。

定位方法：插件日志 -> VM中dmesg日志

1. 插件机制 -- 向VM发送ansible消息，调用脚本进行tar包加载、激活、进度查询。

2. 插件日志 -- 发现ansible回显中激活有报错，进度查询为-1（默认关闭info，可打开info，再次升级查看日志）

3. VM中安装脚本日志 -- 集成开发的脚本，日志dmesg -T查询，发现是tar包中自带的安装脚本执行报错

4. 联系SF补丁包开发支撑 - 日志dmesg -T查询，定位是在/rootbak目录下进行rpm安装时出错。建议欧拉同事定位。

5. 联系欧拉同事定位 - chroot /rootbak,手动安装rpm，根据报错发现是无法创建/var/log/drug.log文件，查看log目录是软链接。手动删除软链接后重新创建，再安装rpm成功。

6. 修复，SF是通用机制。与第三方开发沟通，阐述问题、分析设置软链接的原因和必要性、讨论修复方案。

7. 手动修改SF的补丁安装脚本。给第三方提需求，后续版本修复。

 

关键点：

1. 熟悉EPSN网元的功能及后台模块处理机制，c代码日志

2. 需求是c++插件同事实现的，看设计文档熟悉需求，c代码日志

3. 

需求工作量：1.根据APP的补丁自动安装机制，将FS发布的tar改造为符合规范的补丁包； 2.将手工改造流程变为shell脚本，通过coreCD工程调用实现自动化构建补丁包。

解决问题思路：

1. 使用欧拉syslog服务，hi3上搜配置方式的帖子。

2. 按照帖子配置，报错。查看报错日志，配置问题。从根源解决：查找配置文件说明。

3. hi3上搜不到，很多帖子打不开；
