# 自我介绍

侯霄雄，92年，本硕专业软件工程，毕业一年半后从北京回到西安，入职中软华为事业线云核心网分组交付部MSE团队，一直工作到现在。 
在MSE团队工作期间，从事的是第三方VAS产品开发岗位，目前担任VAS产品的onwer角色，工作内容是负责4个在网的第三方VAS产品 从版本开发、持续集成开发、资料开发到发布维护的一系列工作。
因为第三方VAS产品的特殊性，工作上有一些特殊要求：
1. 工作内容涉及面杂，熟悉第三方产品业务/熟悉MSE的平台网元/熟悉CI构建/熟悉MANO部署因为要写部署指导书/还要熟悉IDP在线写作及资料部的写作规范。
2. 需要良好的沟通耐心和技巧。VAS都是第三方产品，四个厂商中三个都是国外的，其中两个有中国代理商，另外一个需要直接跟外国人打交道。需求适配、开发和线网问题定位就得跟外国研发沟通，除了DNS产品客户都在海外，印度/菲律宾/以色列各种口音，也没有专门的翻译，（一般实在听不懂找SE/线网人员）沟通难度大。
3. 多个工作任务并行。因为涉及维护，同一时间点上，偶尔会存在不同产品来自线网、测试的问题定位或者部署支撑任务（一般还好，根据紧急程度/先来后到安排）；同一时间段内，基本上需要同时进行2-3个版本/补丁的迭代开发（不单是写代码，还有问题定位解决、三方问题跟踪推动、资料开发），这就需要根据PM的发布计划把控开发节奏。

# 工作内容

## 第三方VAS产品

VAS就是网络运营商的增值业务，一般是NAT网络地址转发/DNS域名解析/TO流量优化/VO视频优化等业务。 
华为目前给运营商提的VAS产品，一部分是自己开发的，另外一部分是从第三方厂商采购的。 我现在负责的就是从第三方厂商采购的VAS产品。

## 开发周期

### 版本：快的话2-3个月，慢的话半年。

| 厂商开发 | 集成工作 | 测试及问题解决 | 稳定性 | 资料开发 | 发布资料 |
| 偶尔沟通协助 | 3天 | 7天 | 7天 | 3天 | 1天 |
一般2-3个B版本

### 补丁：一般半个月到一个月，手工制作 

| 开发 | 测试 | 稳定性 | 资料 |
| 3天 | 3天 | 7天 | 2天 |
一般1-2个B版本

## 工作量 

新增app：一个月1-1.5k，vnfd定制一套，镜像脚本定制开发，在现有ci框架上新增一套构建脚本，最终实现可以自动化构建一套可部署的软件包。不关注业务和运维功能是否正常，后续还要调试。

版本迭代：一个B版本 脚本+vnfd，200行以内。涉及到构建、上传、自测、出报告、转测。

补丁：一般在1、2百行代码，包括升级/回退主脚本（补丁都是zip包形式在虚拟机上安装，第三方虚拟机因为安全限制不能直接登录。通过上传到平台虚拟机然后拷贝至第三方虚拟机，进行安装和运行，这些动作要做成一键执行脚本），和具体解决问题的脚本。

## 具体是干什么的？

### 版本开发

与华为自研产品不同，第三方VAS产品的核心业务是第三方开发的，他们提供原始的系统镜像。
但是第三方产品要部署在华为的NFV架构平台上，需要符合华为的安装形式和能力规范。
我们一方面开发VNFD，；另一方面在第三方系统中增加了OM操作维护类插件和一些启动脚本，以达到华为对外发布时承诺的标准能力。

**插件：**在所有虚拟机中都内置了一个OM_Plugin插件，负责监控虚拟机的业务进程是否正常、cpu/mem使用率、磁盘是否正常，并上报心态给平台。一旦心跳停止或者心态内容不正常，就会触发告警，维护人员

**脚本：**最基本的是注入文件解析脚本，部署时可以在界面上填写vlan/ip/路由/能力开关等字段，这些参数会在底层创建VM时放在特定设备里，我们需要根据底层机制去从设备里解析出来传给第三方系统；
此外还有ip路由生成脚本；路由监控脚本；ntpd服务；网卡保序脚本；定时任务；域名注册脚本等。

**VNFD：**虚拟网元描述文件，定义了一个网元有几类虚拟机；每类VM的个数；虚拟机的cpu数量/内存/磁盘大小/网卡数量、类型、拉起顺序；有几个网络/网络类型/每个网卡对应的网络、创建虚拟机时的虚拟机亲和性/绑核亲和性等一系列规则，部署时底层会根据VNFD中定义的规则去创建虚拟机。

### CI持续集成开发

镜像：qemu扩容、格式转换、不同格式镜像挂载、拷贝插件和脚本、rpm包制作、打包、签名；区分x86、arm、VMware等场景。

VNFD：版本号、依赖包等参数替换，打包，生成xml文件，签名

### 资料开发

部署指导书

版本说明书

业务调测指南

### 维护



# 经典案例

## 国内厂商的DNS产品欧拉漏洞升级补丁开发

### 背景

欧拉发布了漏洞升级补丁包【升级失败 - 存储bypass场景的/rootbak/var/log目录不可用】

### 问题

在vmware平台升级成功，但是在FS平台升级失败

### 解决思路及方案

原因：第三方将var/log目录改为了软链接，chroot /rootbak目录后，软链接失效，导致了部分rpm包安装失败。

解决：手动修改FS发布的tar包psp_rpm_patch.sh脚本，在chroot前删除软链接并创建空目录，以完成rpm安装。最终方案需要让三方修改软链接以适配欧拉通用升级机制。

定位方法：插件日志 -> VM中dmesg日志

1. 插件机制 -- 向VM发送ansible消息，调用脚本进行tar包加载、激活、进度查询。
2. 插件日志 -- 发现ansible回显中激活有报错，进度查询为-1（默认关闭info，可打开info，再次升级查看日志）
3. VM中安装脚本日志 -- 集成开发的脚本，日志dmesg -T查询，发现是tar包中自带的安装脚本执行报错
4. 联系SF补丁包开发支撑 - 日志dmesg -T查询，定位是在/rootbak目录下进行rpm安装时出错。建议欧拉同事定位。
5. 联系欧拉同事定位 - chroot /rootbak,手动安装rpm，根据报错发现是无法创建/var/log/drug.log文件，查看log目录是软链接。手动删除软链接后重新创建，再安装rpm成功。
6. 修复，SF是通用机制。与第三方开发沟通，阐述问题、分析设置软链接的原因和必要性、讨论修复方案。
7. 手动修改SF的补丁安装脚本。给第三方提需求，后续版本修复。

### 案例特点

1. 需要熟悉EPSN网元的功能及后台模块处理机制，看得懂日志。
2. 需求是c++插件同事实现的，看设计文档熟悉需求，c代码日志
3. 

需求工作量：1.根据APP的补丁自动安装机制，将FS发布的tar改造为符合规范的补丁包； 2.将手工改造流程变为shell脚本，通过coreCD工程调用实现自动化构建补丁包。

解决问题思路：

1. 使用欧拉syslog服务，hi3上搜配置方式的帖子。
2. 按照帖子配置，报错。查看报错日志，配置问题。从根源解决：查找配置文件说明。
3. hi3上搜不到，很多帖子打不开；

## VO产品5G vmware版本开发

### 背景

土耳其VMware+5G版本 POC版本

### 问题

版本从去年10月份开始做，迭代了4个B版本，

### 解决思路及方案

1. 每天晚上十点半跟第三方开会对齐进展

### 案例特点

典型的第三方产品特点，外国厂商、中国代理商：
1. 时间上难协调，存在时差，美国时间/中国时间/印度时间
2. 办事效率低，问题层层传递，计划赶不上变化
3. 解决问题效率低，需要不断沟通、施压、跟踪推动
这种是非技术性的，还有技术性的案例。

## 国外厂商的DNS产品日志对接syslog需求

### 背景

客户要求通过syslog方式，把虚拟机上的业务操作日志及其他的一些他们需要看的日志推送到第三方syslog服务器上。

### 问题

这个产品是第三方自己的Debian系统，日志内容已满足客户诉求，但是上传方式不满足。他们的系统

### 解决思路及方案

三方使用的欧拉虚拟机，需要通过欧拉的

1. 使用欧拉syslog服务，hi3上搜配置方式的帖子。
2. 按照帖子配置，报错。查看报错日志，配置问题。从根源解决：查找配置文件说明。
3. hi3上搜不到，很多帖子打不开；

虚拟机'/etc/rsyslog.conf'配置；重启rsyslog服务

### 案例特点

给第三方下的需求，他们搞不定的时候，需要自己想办法解决兜底。



